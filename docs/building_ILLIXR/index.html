<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://illixr.github.io/ILLIXR/docs/building_ILLIXR/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Building ILLIXR - ILLIXR Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Building ILLIXR";
    var mkdocs_page_input_path = "building_ILLIXR.md";
    var mkdocs_page_url = "/ILLIXR/docs/building_ILLIXR/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ILLIXR Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">ILLIXR</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../getting_started/">Getting Started</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../default_plugins/">Default Plugins</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../writing_your_plugin/">Writing Your Plugin</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Building ILLIXR</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-a-new-plugin-common-case">Adding a new plugin (common case)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-a-plugin-general-case">Adding a plugin (general case)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#philosophy">Philosophy</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../monado_illixr_runtime_overview/">Monado Integration Overview</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../monado_integration_dataflow/">Monado Integration Dataflow</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../visualizer_logger/">Visualizer & Logger</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="" href="https://illixr.github.io/ILLIXR/api/html/annotated.html">API documentation</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ILLIXR Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Building ILLIXR</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="building-illixr">Building ILLIXR</h1>
<h2 id="basic-usage">Basic usage</h2>
<ul>
<li>
<p>From the project root, <code>make run.dbg -j$(nproc)</code> will build the ILLIXR runtime standalone, the
  ILLIXR plugins, and run it for you. <code>make run.opt -j$(nproc)</code>, is the same but with optimizations on and debug off.</p>
</li>
<li>
<p>To build the runtime for Monado, <code>make all.dbg.so</code>.</p>
</li>
</ul>
<h2 id="adding-a-new-plugin-common-case">Adding a new plugin (common case)</h2>
<p>In the common case, one need only define a <code>Makefile</code> with the line <code>include common/common.mk</code> and
symlink common (<code>ln -s ../common common</code>). This provides the necessary targets and uses the compiler
<code>$(CXX)</code>, which is defined in Make based on the OS and environment variables.</p>
<ul>
<li>
<p>It compiles <code>plugin.cpp</code> and any other <code>*.cpp</code> files into the plugin.</p>
</li>
<li>
<p>It will invoke a recompile the target any time any <code>*.hpp</code> or <code>*.cpp</code> file changes.</p>
</li>
<li>
<p>It compiles with C++17. You can change this in your plugin by defining <code>STDCXX = ...</code> before the
  <code>include</code>. This change will not affect other plugins; just yours.</p>
</li>
<li>
<p>Libraries can be added by appending to <code>LDFLAGS</code> and <code>CFLAGS</code>, for example</p>
<pre><code>LDFLAGS := $(LDFLAGS) $(shell pkg-config --ldflags eigen3)
CFLAGS := $(CFLAGS) $(shell pkg-config --cflags eigen3)
</code></pre>
</li>
<li>
<p>See the source for the exact flags.</p>
</li>
<li>
<p>Inserted the name of your directory into the <code>component</code>-list in the root <code>Makefile</code>.</p>
</li>
</ul>
<h2 id="adding-a-plugin-general-case">Adding a plugin (general case)</h2>
<p>Each plugin can have a completely independent build system, as long as:
- It defines a <code>Makefile</code> with targets for <code>plugin.dbg.so</code>, <code>plugin.opt.so</code>, and <code>clean</code>. Inside
  this <code>Makefile</code>, one can defer to another build system.</p>
<ul>
<li>
<p>It's compiler maintains <em>ABI compatibility</em> with the compilers used in every other plugin. Using
  the same version of Clang or GCC on the same architecture is sufficient for this.</p>
</li>
<li>
<p>It's name is inserted in the root <code>Makefile</code>, in the <code>plugins</code> list.</p>
</li>
</ul>
<h2 id="philosophy">Philosophy</h2>
<ul>
<li>
<p>Each plugin should not have to know or care how the others are compiled. In the future, they may
  even be distributed separately, just as SOs. Therefore, each plugin needs its own build system.</p>
</li>
<li>
<p>Despite this per-plugin flexibility, building the 'default' set of ILLIXR plugins should be
  extremely easy.</p>
</li>
<li>
<p>It should be easy to build in parallel.</p>
</li>
<li>
<p>Always rebuild every time, so the binary is always "fresh". This is a great convenience when
  experimenting. However, this implies that rebuilding must be fast when not much has changed.</p>
</li>
<li>
<p>Make is the de facto standard for building C/C++ programs. GNU Make, reucrsive make, and the
  makefile language begets no shortage of problems [<a href="https://www.conifersystems.com/whitepapers/gnu-make/">1</a>,<a href="https://www.gnu.org/software/cons/stable/cons.html#why%20cons%20why%20not%20make">2</a>,<a href="https://interrupt.memfault.com/blog/gnu-make-guidelines#when-to-choose-make">3</a>,<a href="https://grosskurth.ca/bib/1997/miller.pdf" title="Recursive Make Considered Harmful (AUUGN Journal of AUUG Inc. 1998)">4</a>,<a href="https://doi.org/10.1145/3241625.2976011" title="Non-recursive make considered harmful: build systems at scale (SIGPLAN 2016)">5</a>], but we choose
  Make for its tradeoff of between simplicity and functionality. What it lacks in functionality
  (compared to CMake, Ninja, scons, Bazel, Meson) it makes up for in simplicity. It's still the
  build system in which it is the easiest to invoke arbitrary commands in shell and the easiest to
  have a <code>common.mk</code> included in each plugin. This decision to use Make should be revisited, when
  this project outgrows its ability, but for now, Make remains, in our judgement, <em>the best tool for
  the job</em>.</p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../monado_illixr_runtime_overview/" class="btn btn-neutral float-right" title="Monado Integration Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../writing_your_plugin/" class="btn btn-neutral" title="Writing Your Plugin"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../writing_your_plugin/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../monado_illixr_runtime_overview/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
